"use strict";const e=require("../../../common/vendor.js"),a=require("../../../common/assets.js"),t={components:{NavBar:()=>"../../Nav/NavBar.js"},data:()=>({isWideScreen:!0,logoSrc:"/static/zero_logo.png",activeTab:"wallet",currentBalance:2550.15,showModal:!1,selectedTransaction:{},recentTransactions:[{id:"532",reference:"Withdrawal",amount:200,date:"28/4/24 13:11"},{id:"513",reference:"Commission Deposit",amount:118.73,date:"28/4/24 15:00"},{id:"508",reference:"Commission Deposit",amount:154.22,date:"28/4/24 10:00"},{id:"506",reference:"Commission Deposit",amount:232.77,date:"29/4/24 11:30"},{id:"499",reference:"Withdrawal",amount:500,date:"16/2/24 23:30"}],showWithdrawModal:!1,withdrawalAmount:"",withdrawStatus:"",withdrawMessage:"",showCSVModal:!1,startDate:"",endDate:"",csvRecord:[],showSettingsModal:!1,bankName:"",bankAccNo:"",passwordPrompt:!1,passwordInput:""}),mounted(){this.checkScreen(),window.addEventListener("resize",this.checkScreen)},beforeDestroy(){window.removeEventListener("resize",this.checkScreen)},methods:{handleClick(a){switch(a){case"Withdraw Money":this.showWithdrawModal=!0;break;case"Export CSV":this.showCSVModal=!0;break;case"Transaction History":e.index.navigateTo({url:"/pages/wallet/transaction-history"});break;case"Wallet Settings":this.showSettingsModal=!0;break;default:e.index.showToast({title:`Unknown action: ${a}`,icon:"none"})}},async printCSV(){var a;try{const t=e.index.getStorageSync("username"),o=await e.index.request({url:"http://localhost/commission/backend/database/wallet.php",method:"POST",data:{username:t,action:"downloadCSV",startDate:this.startDate,endDate:this.endDate}});(null==(a=o.data)?void 0:a.csvRecord)&&(this.csvRecord=o.data.csvRecord,this.exportCSVToDevice())}catch(t){console.error(t),e.index.showToast({title:"CSV export failed",icon:"none"})}},exportCSVToDevice(){let e=["id","type","amount","description","date"].join(",")+"\n";this.csvRecord.forEach((a=>{e+=Object.values(a).join(",")+"\n"}));const a=new Blob([e],{type:"text/csv"}),t=URL.createObjectURL(a),o=document.createElement("a");o.href=t,o.download="Transaction_History.csv",o.click(),URL.revokeObjectURL(t),this.showCSVModal=!1},async updateWalletSettings(){try{const a=e.index.getStorageSync("username");await e.index.request({url:"http://localhost/commission/backend/database/wallet.php",method:"POST",data:{username:a,action:"update",bankName:this.bankName,bankNo:this.bankAccNo}}),e.index.showToast({title:"Updated!",icon:"success"}),this.showSettingsModal=!1}catch(a){console.error(a),e.index.showToast({title:"Update failed",icon:"none"})}},home(){e.index.switchTab({url:"/pages/tabbar/Home/home"})},checkScreen(){"undefined"!=typeof window?this.isWideScreen=window.innerWidth>=768:e.index.getSystemInfo({success:e=>{const a="ios"===e.platform||"android"===e.platform;this.isWideScreen=!a}})},changeTab(a){this.activeTab=a;e.index.switchTab({url:{home:"/pages/tabbar/Home/home",wallet:"/pages/tabbar/Wallet/wallet",orders:"/pages/tabbar/Order/order"}[a]||"/"})},openDetails(e){this.selectedTransaction=e,this.showModal=!0},closeDetails(){this.showModal=!1}}};if(!Array){e.resolveComponent("NavBar")()}const o=e._export_sfc(t,[["render",function(t,o,s,i,n,r){return e.e({a:n.isWideScreen},n.isWideScreen?{b:e.o((e=>r.home())),c:a._imports_0,d:"home"===n.activeTab?1:"",e:e.o((e=>r.changeTab("home"))),f:"wallet"===n.activeTab?1:"",g:e.o((e=>r.changeTab("wallet"))),h:"orders"===n.activeTab?1:"",i:e.o((e=>r.changeTab("orders")))}:{j:n.logoSrc,k:e.o(((...e)=>t.handleError&&t.handleError(...e)))},{l:!n.isWideScreen},n.isWideScreen?{}:{m:e.o(r.changeTab),n:e.p({activeTab:n.activeTab})},{o:e.t(n.currentBalance),p:e.t(t.withdrawableBalance),q:e.o((e=>r.handleClick("Withdraw Money"))),r:e.o((e=>r.handleClick("Export CSV"))),s:e.o((e=>r.handleClick("Transaction History"))),t:e.o((e=>r.handleClick("Wallet Settings"))),v:!n.isWideScreen},n.isWideScreen?{x:e.f(n.recentTransactions,((a,t,o)=>({a:e.t(a.id),b:e.t(a.reference),c:e.t(a.amount.toFixed(2)),d:e.t(a.date),e:a.id})))}:{w:e.f(n.recentTransactions,((a,t,o)=>({a:e.t(a.id),b:e.t(a.amount.toFixed(2)),c:e.t(a.date),d:a.id,e:e.o((e=>r.openDetails(a)))})))},{y:n.isWideScreen?1:"",z:n.showModal},n.showModal?{A:e.t(n.selectedTransaction.id),B:e.t(n.selectedTransaction.reference),C:e.t(n.selectedTransaction.amount),D:e.t(n.selectedTransaction.date),E:e.o(((...e)=>r.closeDetails&&r.closeDetails(...e))),F:e.o(((...e)=>r.closeDetails&&r.closeDetails(...e)))}:{},{G:!n.isWideScreen},n.isWideScreen?{}:{H:e.o(r.changeTab),I:e.p({activeTab:n.activeTab})},{J:n.showWithdrawModal},n.showWithdrawModal?{K:e.t(t.withdrawableBalance),L:e.o((e=>n.withdrawalAmount="10.00")),M:e.o((e=>n.withdrawalAmount="50.00")),N:e.o((e=>n.withdrawalAmount="100.00")),O:n.withdrawalAmount,P:e.o((e=>n.withdrawalAmount=e.detail.value)),Q:e.t(n.bankName),R:e.t(n.bankAccNo),S:e.o(((...e)=>t.validateWithdraw&&t.validateWithdraw(...e))),T:e.o((e=>n.showWithdrawModal=!1))}:{},{U:n.passwordPrompt},n.passwordPrompt?{V:n.passwordInput,W:e.o((e=>n.passwordInput=e.detail.value)),X:e.o(((...e)=>t.confirmWithdraw&&t.confirmWithdraw(...e))),Y:e.o((e=>n.passwordPrompt=!1))}:{},{Z:n.withdrawMessage},n.withdrawMessage?{aa:e.t(n.withdrawStatus),ab:e.t(n.withdrawMessage),ac:e.o((e=>n.withdrawMessage="")),ad:e.o((e=>n.withdrawMessage=""))}:{})}],["__scopeId","data-v-ae783142"]]);qa.createPage(o);
